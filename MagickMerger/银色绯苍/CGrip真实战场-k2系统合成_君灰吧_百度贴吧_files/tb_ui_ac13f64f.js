var UiBubbleTipBase=function(b){var a={content:"",arrow_dir:"up",bubble_css:{width:170},arrow_pos:{},attr:"",wrap:$("body"),closeBtn:false,level:1,arrowReq:true};this._option=$.extend(true,a,b);this._event={};this.init()};UiBubbleTipBase.bubbles={};UiBubbleTipBase.count=0;UiBubbleTipBase.prototype={constructor:UiBubbleTipBase,init:function(a){this.buildBubble()},buildBubble:function(){var a=this._option;_html=this.genericTpl(),wrap=a.wrap;this.j_bubble=$(_html);wrap.append(this.j_bubble);this.j_bubble.css(a.bubble_css);this.j_bubble.find(".j_ui_triangle").css(a.arrow_pos);this.j_bubble.find(".j_body").html(a.content);if(a.arrow_dir=="up"||a.arrow_dir=="down"){this.j_bubble.find(".j_content").css({width:a.bubble_css["width"]})}else{this.j_bubble.find(".j_content").css({width:(a.bubble_css["width"]-7)})}if(a.closeBtn){this.j_bubble.find(".j_close").show()}if(!a.arrowReq){this.hideArrow()}this._bindEvent();this.cid="bubble_"+UiBubbleTipBase.count;UiBubbleTipBase.count++},_bindEvent:function(){var b=this._option,a=this;if(b.closeBtn){this.j_bubble.find(".j_close").click(function(){var c=a.triggerEvent("onclose");if(!c){return}a.closeBubble()})}},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(a){var d=true;if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){d=false}}}return d},genericTpl:function(){var a=this._option.attr,b=this._option.arrow_dir;_html='<div class="ui_bubble_wrap j_wrap" '+a+' style="display:none;"><div class="j_content ui_bubble_content ui_bubble_'+b+'"><div class="ui_bubble_body j_body"></div><div class="ui_bubble_closed j_close"></div></div><div class="j_ui_triangle ui_triangle ui_triangle_'+b+'"><div class="ui_triangle_outter ui_arrow_o_'+b+'" ><em>\u25c6</em></div><div class="ui_triangle_inner ui_arrow_i_'+b+'" ><em>\u25c6</em></div></div></div>';return _html},closeBubble:function(){this.j_bubble.remove();delete UiBubbleTipBase.bubbles[this.cid]},hideArrow:function(){this.j_bubble.find(".ui_triangle").hide()},hideBubble:function(){this.j_bubble.hide()},showBubble:function(a){if(a){if(a.zIndex){this._getBubbleInfo(a.zIndex);this.j_bubble.css({"z-index":a.zIndex});this.showByTime(a.type,a.time)}else{this._getBubbleInfo();var b=this._handleCover();if(!b){this.showByTime(a.type,a.time)}}}else{this._getBubbleInfo();var b=this._handleCover();if(!b){this.j_bubble.show()}}},showByTime:function(b,c){var a=this;if(b=="delayShow"){setTimeout(function(){a.j_bubble.show()},c)}else{if(b=="delayClose"){a.j_bubble.show();setTimeout(function(){a.closeBubble()},c)}else{a.j_bubble.show()}}},_getBubbleInfo:function(d){var b=this,h=b.j_bubble,c=h.width();h.width(0);h.show();var g=h.offset(),f=g.top,e=g.left,a=h.find(".j_body").height()+12;h.hide();h.width(c);b.minL=e;b.maxL=e+c+7;b.minT=f;b.maxT=f+a;if(d){b.bubbleType="inter"}UiBubbleTipBase.bubbles[b.cid]=b},_isCover:function(){var d=this,f=d.cid,c=UiBubbleTipBase.bubbles,b=d;for(var e in c){if(e==f||d.bubbleType=="inter"||c[e].j_bubble.get(0).style.display=="none"){}else{var a=c[e];if(b.minL<a.maxL&&b.maxL>a.minL&&b.minT<a.maxT&&b.maxT>a.minT){return a}}}return false},_handleCover:function(){var d=this._isCover(),b=this;if(d){var c=d._option.level,a=b._option.level;if(a>c){d.j_bubble.fadeOut("slow");return false}else{return true}}return false},setBubblePosition:function(a){if(a&&(a.top||a.left)){this.j_bubble.css(a)}},setBubbleFixed:function(){if(!($.browser.msie&&$.browser.version=="6.0")){this.j_bubble.addClass("ui_bubble_wrap_fixed")}else{this.j_bubble.addClass("ui_bubble_fixed_hack")}},setBubbleNormal:function(){if(!($.browser.msie&&$.browser.version=="6.0")){this.j_bubble.removeClass("ui_bubble_wrap_fixed")}else{this.j_bubble.removeClass("ui_bubble_fixed_hack")}},setFixedForMessage:function(){var a=this,c;var b=null;if(c){clearTimeout(c)}$(window).bind("scroll",function(){if(c){clearTimeout(c)}if(b==null){b=a.j_bubble.position()}c=setTimeout(function(){a._bubleFixedSet(b)},10)})},_bubleFixedSet:function(b){var a=this,c=$(window).scrollTop(),d=this._option;if(c>b.top){a.setBubbleFixed();if(!($.browser.msie&&$.browser.version=="6.0")){a.j_bubble.css({top:-5})}a.j_bubble.find(".ui_triangle").hide()}else{a.setBubbleNormal();a.j_bubble.css({top:b.top});a.j_bubble.find(".ui_triangle").show()}}};;var PopWindow=function(b){var a={styleId:1,templateObj:{title:"\u65e0",content:"\u65e0",button:"\u65e0",note:"\u65e0",link:"#"}};this._option=$.extend(true,a,b);this._event={}};PopWindow.prototype={constructor:PopWindow,bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},trigger:function(a){if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){return false}}}return true},_buildHtml:function(){var b=this;if($("#pop_frame").length>0){return false}var e=this._option;var d=$("#j_popWindow_tpl_"+e.styleId).html();var c=e.templateObj.title;e.templateObj.title=c+b._sayHi();var a=$.tb.format(d,e.templateObj);this.PopupContainer=document.createElement("div");this.PopupContainer.id="pop_frame";this.PopupContainer.innerHTML=a;document.body.appendChild(this.PopupContainer);setTimeout(function(){b._setAnimation();b._eventInit()},200)},_setAnimation:function(){var a=$("#pop_animate"),b=a.outerHeight();$("#pop_frame").css({height:(b+2)+"px"});a.css({height:b+"px",top:b+"px"}).animate({top:"0px"},"slow")},_sayHi:function(){var a="";var b=new Date().getHours();if(b>=0&&b<5){a="\uff1a"}else{if(b>=5&&b<9){a="\uff0c\u65e9\u4e0a\u597d\uff1a"}else{if(b>=9&&b<12){a="\uff0c\u4e0a\u5348\u597d\uff1a"}else{if(b>=12&&b<14){a="\uff0c\u4e2d\u5348\u597d\uff1a"}else{if(b>=14&&b<18){a="\uff0c\u4e0b\u5348\u597d\uff1a"}else{if(b>=18&&b<24){a="\uff0c\u665a\u4e0a\u597d\uff1a"}}}}}}return a},_eventInit:function(){var c=this,b=$("#pop_frame");b.find(".pop_close").click(function(){var d=c.trigger("closeSuccess");if(!d){return}$("#pop_frame").remove();return false});var a=b.find(".pop_button");a.click(function(){var d=c.trigger("clickBtn");if(!d){return}$("#pop_frame").remove()});a.mousedown(function(){$(this).removeClass("pop_button_normal pop_button_hover").addClass("pop_button_down");$(this).find("span").removeClass("btn_right_part_normal btn_right_part_hover").addClass("btn_right_part_down")});a.hover(function(){$(this).removeClass("pop_button_normal pop_button_hover").addClass("pop_button_hover");$(this).find("span").removeClass("btn_right_part_normal btn_right_part_down").addClass("btn_right_part_hover")},function(){$(this).removeClass("pop_button_down pop_button_hover").addClass("pop_button_normal");$(this).find("span").removeClass("btn_right_part_hover btn_right_part_down").addClass("btn_right_part_normal")})},showPop:function(){var a=this;a._buildHtml()}};;var Enum={FileStatus:{NONE:0,RUNNING:1,ERROR:2,COMPLETE:3},ProcessorStatus:{NOTSTART:0,RUNNING:1,PAUSE:2,COMPLETE:4,ERROR:5},ProcessorCommand:{PAUSE:0,STOP:1,NONE:2},Error:{NONE:{no:0,msg:""},FILE_SIZE_OVERFLOW:{no:1,msg:"\u6587\u4ef6\u5927\u5c0f\u8d85\u51fa\u9650\u5236"},NETWORK_ERROR:{no:2,msg:"\u7f51\u7edc\u9519\u8bef"},JSON_PARSE_ERROR:{no:3,msg:"\u6570\u636e\u8f6c\u6362\u5931\u8d25"}}};var Compressor=function(){var b=null;var c=null;var a=function(){b=document.createElement("canvas");c=b.getContext("2d")};this.compress=function(j){var f=!!j.quality?j.quality:1;var m=!!j.imageType?j.imageType:"image/jpeg";var l=1;var i=j.image.width;var o=j.image.height;if(!!j.maxWidth&&j.maxHeight){var g=i/j.maxWidth;var n=o/j.maxHeight;l=g>n?1/g:1/n}l=!!j.rate?j.rate:l;var h=j.isIos?d(j.image,i,o):1;b.width=i*l;b.height=o*l;c.clearRect(0,0,i,o);c.scale(l,l/h);c.drawImage(j.image,0,0);var k=b.toDataURL(m,f);var p=((k.length-814)/1.37);if(!!j.maxSize&&j.maxSize<p){f=j.maxSize/p;k=b.toDataURL(m,f)}return k};var e=function(){};var d=function(i,f,n){b.width=1;b.height=n;c.drawImage(i,0,0);var h=c.getImageData(0,0,1,n).data;var l=0;var j=n;var m=n;while(m>l){var g=h[(m-1)*4+3];if(g===0){j=m}else{l=m}m=(j+l)>>1}var k=(m/n);return(k===0)?1:k};a()};var MImage={};MImage._createImage=function(b){var a=new Image();a.size=b.file.size||0;a.name=b.file.name||"";a.type=b.file.type||"";a.percent=0;a.status=Enum.FileStatus.NONE;a.response="";a.errorCode=0;a.errorMessage="";a.onLoaded=b.onLoaded;a.id="img_"+(new Date()).getTime()+"_"+a.type;a.getData=function(){return MImage._getImageData(a.src)};a.getPostData=function(){return MImage._getPostData(a)};return a};MImage._getPostData=function(a){return{file:{filename:a.name,type:a.type,content:a.getData()}}};MImage._getImageData=function(a){return a.split(",")[1]};MImage._calImageSize=function(a){return((a.length-814)/1.37)};MImage._readImage=function(b,c){var a=new FileReader();a.onload=function(d){if(!!c){c(d.target.result)}};a.readAsDataURL(b)};MImage._compressImage=function(e,b,d,c,f){var a=new Compressor();if(e.width>d||e.height>c){return a.compress({image:e,maxWidth:d,maxHeight:c,maxSize:f})}return e.src};MImage.create=function(d){var a=new Compressor();var b=false;var c=null;c=MImage._createImage(d);c.onload=function(){if(!b&&!!d.maxWidth&&!!d.maxHeight&&(c.width>d.maxWidth||c.height>d.maxHeight)){c.src=MImage._compressImage(c,c.type,d.maxWidth,d.maxHeight,d.maxSize);c.size=MImage._calImageSize(c.src);b=true}else{if(!!c.onLoaded){c.onLoaded(c);c.onLoaded=null}b=false}};MImage._readImage(d.file,function(e){c.src=e});return c};var Queue=function(){this._queue=[];this._index=0;this.push=function(a){if(typeof a!="Array"){this._queue.push(a)}else{this._queue.concat(a)}};this.pop=function(){return this._queue[this._index++]};this.remove=function(a){this._queue.splice(a,1)};this.insert=function(b,a){this._queue.splice(b,a,0)};this.clear=function(){this._queue=[];this._index=0};this.length=function(){return this._queue.length};this.remainLength=function(){return this._queue.length-this._index};this.get=function(a){return this._queue[a]};this.toArray=function(){return this._queue}};var ImageQueue=function(c){Queue.call(this);var d=0;var a=c.maxLength||10;var l=c.maxWidth||0;var j=c.maxSize||5242880;var k=c.maxHeight||0;var i=this;var f=c.onLoaded||null;var e=c.onItemLoaded||null;var g=function(){};var b=function(m){m.status=Enum.FileStatus.NONE;i.push(m);if(!!e){e(m)}if(d==i.length()){if(!!f){f(i.toArray())}}};var h=function(m){if(i.length()<a){MImage.create({file:m,maxWidth:l,maxHeight:k,maxSize:j,onLoaded:b});return true}else{alert("The queue is exceeded!");return false}};this.pop=function(){var m=null;while(this._index<this._queue.length){m=this._queue[this._index++];if(m.status==Enum.FileStatus.NONE){return m}}return null};this.concat=function(n){d+=n.length;for(var m=0;m<n.length;m++){if(h(n[m])){continue}else{break}}};this.isComplete=function(){var n=0;for(var m=0;m<this.length();m++){if(this.get(m).status!=Enum.FileStatus.NONE&&this.get(m).status!=Enum.FileStatus.RUNNING){n++}}return n==this.length()};this.getCompleteItems=function(){var m=[];for(var n=0;n<this.length();n++){if(this.get(n).status!=Enum.FileStatus.NONE&&this.get(n).status!=Enum.FileStatus.RUNNING){m.push(this.get(n))}}return m};this.remove=function(m){this._queue.splice(m,1);d--};this.reset=function(){this.clear();d=0}};var FilePoster=function(d,j){var a=null;var b=d||{timeout:100};var f=this;var c=function(){a=new XMLHttpRequest();i()};var i=function(){if(!a.sendAsBinary){a.sendAsBinary=function(l){var k=Array.prototype.map.call(l,function(m){return m.charCodeAt(0)&255});a.send(new Uint8Array(k).buffer)}}};var e=function(n){var m=new FormData();for(var l in n){m.append(l,n[l])}return m};var h=function(o){var p="----WebKitFormBoundary"+Math.random();var l="--"+p;var n=[];for(var m in o){n.push(l);if(typeof o[m]=="object"){n.push('Content-Disposition: form-data; name="'+m+'"; filename="'+o[m].filename+'"');n.push("Content-Type: "+o[m].type);n.push("");n.push(atob(o[m].content))}else{n.push('Content-Disposition: form-data; name="'+m+'"');n.push("");n.push(o[m])}}n.push(l+"--");return{boundary:p,payload:n.join("\r\n")}};var g=function(m){if(!m){return}for(var l in m){f.bind(l,m[l])}};this.bind=function(l,m){a[l]=m;if(l=="onprogress"){a.upload[l]=m}};this.sendAsBinary=function(k,n,l){var m=h(n);g(l);a.open("POST",k,true);a.setRequestHeader("Content-Type","multipart/form-data; boundary="+m.boundary);a.sendAsBinary(m.payload)};this.sendAsForm=function(k,n,l){var m=e(n);g(l);a.open("POST",k,true);a.send(m)};c();g(j)};var Processor=function(){this.conf={};this.handler={onPause:null,onContinue:null,onStop:null,onProcessing:null,onComplete:null,onError:null};this._command=Enum.ProcessorCommand.NONE;this._status=Enum.ProcessorStatus.NOTSTART;this.bind=function(a,b){this.handler[a]=b};this.runHandler=function(a,b){if(!!a){a(b)}};this.process=function(){this._status=Enum.ProcessorStatus.RUNNING;this._command=Enum.ProcessorCommand.NONE};this.pause=function(){this._command=Enum.ProcessorCommand.PAUSE};this.goOn=function(){this._status=Enum.ProcessorStatus.RUNNING;this._command=Enum.ProcessorCommand.NONE};this.stop=function(){this._command=Enum.ProcessorCommand.STOP};this.extend=function(c,b){for(var a in b){c[a]=b[a]}}};var Uploador=function(h,k){Processor.call(this);var l=null,j=this,e=null,b=null;$.extend(this.conf,{timeout:300,url:""});j.extend(this.conf,{timeout:h.timeout||300,url:h.url||""});j.extend(this.handler,k);var f=function(){b=new FilePoster({timeout:j.timeout},{onprogress:g,onload:d,ontimeout:i,onabort:c,onerror:c})};var a=function(m,n){j.runHandler(m,n)};var g=function(n){var m=n.lengthComputable?n.loaded/n.total:1;l.percent=m;a(j.handler.onProcessing,l)};var d=function(m){l.response=null;try{l.response=JSON.parse(m.target.responseText);l.status=Enum.FileStatus.COMPLETE;j._status=Enum.ProcessorStatus.COMPLETE;if(!!j.handler.onComplete){a(j.handler.onComplete,l)}}catch(m){j._status=Enum.ProcessorStatus.ERROR;l.status=Enum.FileStatus.ERROR;l.errorCode=Enum.Error.JSON_PARSE_ERROR.no;l.errorMessage=Enum.Error.JSON_PARSE_ERROR.msg;j.runHandler(j.handler.onError,l)}};var i=function(m){j._status=Enum.ProcessorStatus.ERROR;l.status=Enum.FileStatus.ERROR;l.errorCode=Enum.Error.NETWORK_ERROR.no;l.errorMessage=Enum.Error.NETWORK_ERROR.msg;j.runHandler(j.handler.onError,l)};var c=function(m){j._status=Enum.ProcessorStatus.ERROR;l.status=Enum.FileStatus.ERROR;l.errorCode=Enum.Error.NETWORK_ERROR.no;l.errorMessage=Enum.Error.NETWORK_ERROR.msg;j.runHandler(j.handler.onError,l)};this.process=function(o){var m=!!o.url?o.url:h.url;m=m+"&r="+Math.random();var n=o.file.getData();l=o.file;l.status=Enum.FileStatus.RUNNING;this._status=Enum.ProcessorStatus.RUNNING;b.sendAsBinary(m,l.getPostData())};f()};var UploadorPool=function(f,q){Processor.call(this);var i=null,n=[],j=this;var e=0;j.extend(j.conf,{maxLength:f.maxLength||2,url:f.url||""});j.extend(j.handler,{onItemComplete:null,onItemStart:null,onItemError:null,onItemProcessing:null,onComplete:null,onStart:null,onError:null,onPause:null,onProcessing:null});if(!!q){j.extend(j.handler,q)}var d=function(r){j.runHandler(j.handler.onItemComplete,r);l();b();g()};var c=function(r){j.runHandler(j.handler.onItemError,r);j.runHandler(j.handler.onError,r);l();b();g()};var o=function(r){j.runHandler(j.handler.onItemProcessing,r);e=h();j.runHandler(j.handler.onProcessing,{percent:e,imageList:i.toArray()})};var h=function(){var r=i.toArray();var t=0;for(var s=0;s<r.length;s++){t+=r[s].percent}return r.length<=0?1:t/r.length};var p=function(r){return new Uploador({url:j.conf.url,id:n.length},{onComplete:d,onProcessing:o,onError:c})};var m=function(){var r=null;for(var s=0;s<n.length;s++){if(n[s]._status!=Enum.ProcessorStatus.RUNNING){r=n[s];break}}if(r==null&&n.length<j.conf.maxLength){r=p();n.push(r)}return r};var k=function(){var s=0;for(var r=0;r<n.length;r++){if(n._status!=Enum.ProcessorStatus.RUNNING){s++}}return s==n.length};var b=function(){if(j._status!=Enum.ProcessorStatus.COMPLETE&&j._command==Enum.ProcessorCommand.NONE){j.process({queue:i})}};var g=function(){if(j._command==Enum.ProcessorCommand.PAUSE&&j._status==Enum.ProcessorStatus.RUNNING&&k()){j._status=Enum.ProcessorStatus.PAUSE;j.runHandler(j.handler.onPause,{percent:e,imageList:i.toArray()})}};var l=function(){if(i.isComplete()&&j._status!=Enum.ProcessorStatus.COMPLETE){j._status=Enum.ProcessorStatus.COMPLETE;j.runHandler(j.handler.onComplete,{percent:100,imageList:i.toArray()});return true}return false};var a=function(){if(!i){return}j._command=Enum.ProcessorCommand.NONE;j._status=Enum.ProcessorStatus.RUNNING;if(l()){return}while(i.remainLength()>0){var s=m();if(s!=null){var r=i.pop();if(!!r){j.runHandler(j.handler.onItemStart,r);s.process({file:r})}}else{break}}};this.process=function(r){j.conf.url=r.url||j.conf.url;i=r.queue;j.runHandler(j.handler.onStart,i.toArray());a()};this.pause=function(){this._command=Enum.ProcessorCommand.PAUSE};this.goOn=function(){a()};this.bind=function(r,s){j.handler[r]=s};this.reset=function(){this._command=Enum.ProcessorCommand.NONE;this._status=Enum.ProcessorStatus.NOTSTART;e=0}};var MultiUploador=function(e,k){Processor.call(this);var h=this,g=null,d=null,l=null;h.extend(h.conf,{maxWidth:0,maxHeight:0,maxSize:5242880,container:null,isAutoUp:false,queueLen:10,maxParallel:1,postType:0,postUrl:""});h.extend(h.handler,{onFileSelected:null,onStartUpload:null,onProgressListen:null,onStopUpload:null,onError:null,onComplete:null,onImageLoaded:null});if(!!k){h.extend(h.handler,k)}var b=function(){l=$("<input type='file' accept='image/*' />").css({opacity:"0",width:h.conf.container.width()+"px",height:h.conf.container.height()+"px"}).attr("multiple","multiple");l.appendTo(h.conf.container);l.bind("change",a);d=new UploadorPool({maxLength:h.conf.maxParallel,url:h.conf.postUrl});f()};var f=function(){d.bind("onComplete",function(m){h.runHandler(h.handler.onComplete,m);g.reset()});d.bind("onProcessing",function(m){h.runHandler(h.handler.onProgressListen,m)});d.bind("onError",function(m){h.runHandler(h.handler.onError,m)});d.bind("onPause",function(m){h.runHandler(h.handler.onStopUpload,m)})};var a=function(m){if(!g){g=new ImageQueue({maxLength:h.conf.queueLen,onLoaded:i,onItemLoaded:j,maxWidth:h.conf.maxWidth,maxHeight:h.conf.maxHeight,maxSize:h.conf.maxSize})}g.concat(m.target.files);c()};var c=function(){l.val("")};var j=function(m){if(m.size>h.conf.maxSize){m.status=Enum.FileStatus.ERROR;m.errorCode=Enum.Error.FILE_SIZE_OVERFLOW.no;m.errorMessage=Enum.Error.FILE_SIZE_OVERFLOW.msg;h.runHandler(h.handler.onError,m)}h.runHandler(h.handler.onImageLoaded,m)};var i=function(m){h.runHandler(h.handler.onFileSelected,{percent:0,imageList:m});if(h._command==Enum.ProcessorCommand.NONE&&h.conf.isAutoUp){h.startUpload()}};this.start=function(m){this.runHandler(h.handler.onStartUpload,{percent:0,imageList:g.toArray()});d.process({queue:g})};this.stop=function(){d.pause()};this.goOn=function(){d.process({queue:g})};this.clearList=function(){g.reset()};this.deleteFile=function(o){var m=g.toArray();for(var n=0;n<m.length;n++){if(!!m[n].id&&m[n].id==o){g.remove(n)}}};b()};var Html5Uploader={Enum:Enum,MImage:MImage,Queue:Queue,ImageQueue:ImageQueue,FilePoster:FilePoster,Processor:Processor,Uploador:Uploador,UploadorPool:UploadorPool,MultiUploador:MultiUploador};;