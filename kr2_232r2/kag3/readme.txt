============================================================================
                         KAG 3 version 3.32 revision 2
============================================================================
                                                            2010/10/26 W.Dee

  ※ このソフトウェアのライセンスについて、license.txt をご覧ください (重要)

■ このソフトウェアについて ------------------------------------------------

  　KAG は、Kirikiri Adventure Game system の略です。KAG 3 は、吉里吉里２で
  動作する、吉里吉里２をアドベンチャー/ノベルゲームのゲームコアとして動作さ
  せるためのスクリプトです。


■ フォルダの内容 ----------------------------------------------------------

  template\           KAG 3 テンプレート
  kag3doc\            KAG 3 のドキュメント (HTML形式)
  kag3doc\tagdb_xml   KAG 3 のタグ情報ファイル (XML形式)
  kag3plugin\         KAG 3 用プラグイン *1

  syoukai\            吉里吉里/KAG の紹介用スクリプト *2 *3

  *1 使い方は各フォルダの .txt ファイルをご覧ください。

  *2 これを実行するには、krkr.eXe を起動したときに最初にでてくる「フォルダ/
     アーカイブの選択」の画面でこれらのフォルダを指定してください。

  *3 このスクリプトは template フォルダ内に入っているシステムを使用します。
     フォルダ構成が配布時と異なる場合や、template フォルダ内のシステムスクリ
     プトが改変された場合は正常に動作しなくなる場合があります。
     また、Releaser でそのままアーカイブ化しても動作しません。


■ 変更点 ------------------------------------------------------------------

  ● 2010/10/26 3.32 Rev.2

    (変更点はありません)

  ● 2010/9/28 3.32

    ・imageタグに shadow等追加(影の追加)
    ・imageタグに lightcolor, lighttype 属性追加 (環境光色)
    ・currentWithBack で裏表両面のメッセージレイヤーに文字を描画している際、
      最終行で改行(r)した次のページから、表と裏で異なる場所に文字が描画され
      るようになっていた問題を修正
    ・セーブラベルと quake タグの位置関係によっては restore() 後に quaking
      値が狂う事があったため restoreQuake() 内で帳尻合わせを行うようにした

  ● 2008/9/28 3.30 Rev.2

    (変更点はありません)

  ● 2008/9/16 3.30 Release

    ・追加の読み進みキーを config.tjs で指定できるように

  ● 2008/1/24 3.30 RC 1

    ・EditLayer.tjsの Edit_selLength を削除(実際には利用されていなかったため)
    ・windowzoom.ks 使用時にフルスクリーン中に「フルスクリーン」メニューを
      選択すると例外が発生していたのを修正
    ・シナリオファイルの最後の行がタブで、タブの後に改行が無いままファイルの
      終わりになっている場合、EAccessViolation 例外が発生していたのを修正

  ● 2007/10/22 3.29-dev.20071022

    ・シナリオファイルの最後の行がタブで、タブの後に改行が無いままファイルの
      終わりになっている場合、EAccessViolationが発生していたのを修正
    ・videoタグにmode=mixerを追加 (VMR9ミキサモード)
    ・ムービーのオーバーレイ再生の場合、内部的に mixer モードで試行するように
      (一部のVista環境でムービーの拡大表示時に補間が効かない問題に対する対処)

  ● 2007/9/8 3.29-dev.20070908

    (変更点はありません)

  ● 2007/9/1 3.29-dev.20070901

    ・スペースキーやEnterキー長押しでのスキップがしづらくなっていたのを改善
      (3.27-dev.20060527 あたりからの問題)

  ● 2007/6/12 3.29-dev.20070612

    (変更点はありません)

  ● 2007/5/21 3.29-dev.20070521

    ・キーボードでマウスカーソルを移動する際に、マウスカーソル移動後のマウ
      スカーソル移動イベントの処理を自前で処理せずにシステムに任せるように
      (リンクとグラフィカルボタンなどの onleave, onenter の発生順序を修正)

  ● 2007/4/16 3.29-dev.20070416

    (変更点はありません)

  ● 2007/1/13 3.29-dev.20070113

    ・MessageLayer.shadowOffsetX および MessageLayer.shadowOffsetY 追加(この
      設定を変更するには、いまのところ直接メッセージレイヤのオブジェクトのこ
      れらの変数に値を代入する)
    ・ButtonLayer を改良し、ボタンが本当に押されていたときだけに onExecute 
      メソッドを呼ぶように (吉里吉里本体は、ウィンドウ内でマウスボタンが離
      されると、たとえそのウィンドウ内でボタンが押されていなくてもメッセー
      ジを送ってしまうため)

  ● 2006/12/18 3.29-dev.20061218

    ・krkr.console.logとhwexcept.logを栞と同じ場所に記録するように

  ● 2006/11/19 3.29-dev.20061119

    (変更点はありません)

  ● 2006/11/7 3.29-dev.20061107

    ・editタグで生成される単一行エディットで、範囲指定やCtrl+X,C,Vによるコ
      ピーや貼り付け、切り取りができるように (thx. HALOさん)

  ● 2006/10/9 3.28 RC 1

    (変更点はありません)

  ● 2006/8/13 3.27-dev.20060813

    ・メッセージレイヤに新しくリンクやボタンを置いたときにリンクのロックが解
      除されるが、反対側の (表←→裏) のレイヤのリンクのロックまで解除してい
      たのをしないようにした

  ● 2006/7/30 3.27-dev.20060730

    ・ignoreCR=false の場合、改行で r タグが生成されるが、この際 eol=true と
      いう属性がつくように (明示的にスクリプト中で [r] タグを使った場合はこ
      の属性はfalseになるのではなく、この属性が「ついてこない」)

  ● 2006/7/10 3.27-dev.20060710

    ・ignore タグの真偽値の解釈が逆になっていたのを修正 (3.27-dev.20060108 で
      エンバグ)
    ・グラフィカルボタンのonMouseUpでMessageLayer.selProcessLockを見ていな
      かったので、たとえばボタン上で右クリックホールド中に左をダブルクリック
      などの場合に異常な動作をしていたのを修正
    ・BGMのセーブ時のpaused状態を保存するように
    ・ロード時に再生されているBGMがセーブ時の物と同じ場合にも曲を最初から再
      生するように変更

  ● 2006/5/27 3.27-dev.20060527

    ・文字表示速度がノーウェイトの時に、Enterやスペースキーを押しっぱなしに
      しても早送りにならなかったのを修正
    ・KAGで属性の値を省略すると "true" が指定されたと見なされるように

  ● 2006/2/19 3.27-dev.20060219

    (変更点はありません)

  ● 2006/1/8 3.27-dev.20060108

    ・スプライン曲線の計算式が間違っていたため修正
    ・else/elsif タグ追加 (thx. sugiさん)

  ● 2005/11/1 3.26 RC 2

    (変更点はありません)

  ● 2005/10/10 3.26 RC 1

    ・内部的に MessageLayer.face を フォント名としてつかっているが、
      Layer.face バッティングするので fontFace に改名

  ● 2005/9/13 3.25 beta 11

    ・mappfont でフォントを割り当てる際に、現在のフォント設定がレイヤのfont
      オブジェクトに設定されていないために正しくフォントが割り当てられなかっ
      たのを修正

  ● 2005/9/3 3.25 beta 10

    (変更点はありません)

  ● 2005/8/23 3.25 beta 9

    ・ltAddAlpha 形式のメッセージレイヤの場合、色の付いた(黒以外の) メッセー
      ジレイヤの半透明透過がおかしかったのを修正
    ・pimageでの画像の重ね合わせがalphaのはずなのにaddalphaとして扱われてし
      まっていたのを修正(beta 8で混入)
    ・pimageのmode属性省略時の動作がおかしかったのを修正(beta 8で混入)

  ● 2005/8/9 3.25 beta 8

    ・image/pimage タグの mode 属性で、 "psadd" など吉里吉里 2.25 beta 8 で
      新たに使用可能になったレイヤタイプを受けつけるように

  ● 2005/8/1 3.25 beta 7

    ・縦書きモードで行サイズを変更すると「負の不透明度はこの face では指定
      できません」という例外が発生していたのを修正
    ・Conductor.getNextTag() の中の iscript などで pendings にタグが追加され
      た場合に、タグの実行順序がおかしくなるのを修正 (beta6 で混入)

  ● 2005/7/14 3.25 beta 6

    ・Conductor クラスのメンバ pending を配列にし、名前を pendings に変更。
      Conductor.enqueueTag() を追加
    ・KAGWindow.restoreFlags() で、internalRestoreFlags() の呼び出しを
      コンダクタ設定より後にした (KAGPlugin の onRestore() からコンダクタを
      いじれるようにするため)
    ・KAGParser クラスのリファレンスを作成 (吉里吉里本体のクラスリファレンス
      にあります)
    ・自動読み進みかどうかをシステム変数に保存しないようにした
    ・[wp]と右クリックメニューでデッドロックしてしまう不具合を修正。About.ks
      でエラーがでる不具合を修正

  ● 2005/6/12 3.25 beta 5

    ・ムービーの途中でもセーブできるように(SWF再生時除く)
    ・resumevideo タグ追加
    ・videoタグにplayRate, audioVolume, audioBalance, audiostreamnum属性を
      追加
    ・Config.tjs に numVideos 追加、複数ムービーの同時再生を可能に (各ビデオ
      関連のタグにも slot という属性が追加されています)

  ● 2005/4/27 3.25 beta 4

    ・closeタグにask属性追加

  ● 2005/3/29 3.25 beta 3

    ・@iscript 〜 @endscript 内でシナリオファイルの遷移を行った場合に
      EAccessViolation 例外が発生する可能外があったのを修正
    ・[close]タグで「オブジェクトは既に無効化されています」エラーが発生してい
      たのを修正
    ・グラフィカルボタンとリンクを同時に表示した場合にTAB・カーソル移動順がお
      かしくなっていたのを修正(2.23rev3での変更を再適用)

  ● 2005/2/22 3.25 beta 2

    ・kag3/kag3plugin/windowzoom 追加。「画面」メニューからレイヤの表示倍率
      を変更できるようにするプラグイン
    ・ゲームパッドのキーマッピング周りの改良。パッドのボタンで読み進められな
      い不具合を修正
    ・KAGでシナリオの再ロード時にEAccessViolation例外が発生したり、アニメー
      ションが裏←→表コピー時に停止してしまっていたりした不具合を修正
      (3.25 beta 1 で混入)

  ● 2005/2/6 3.25 beta 1

    ・スペースキーやEnterキーを長押ししたときに、キューにキーが溜まって、
      キーを離しても読み進みが止まらないことがあったのを改善
    ・KAGのシナリオファイルをメモリ上に8個までキャッシュするようにした
    ・@call がファイルの最終行だった場合(@callの次の行が無い場合) @call の呼
      び出し時にEAccessViolationが発生していたのを修正
    ・ノーウェイト・ページ末まで一気に表示などの状況で状態でAキーを連打する
      とエラーが発生して停止することがあったのを修正
    ・kag.shutdown がevalタグから呼ばれたとき、「オブジェクトは既に無効です」
      でエラーとなっていたのを回避

  ● 2004/12/20 3.23 beta 11

    ・レイヤでムービーを再生できるように
      (追加されたタグについては
       http://kaede-software.com/krlm/kag_ref.html をご覧ください)

  ● 2004/11/27 3.23 beta 10

    (変更点はありません)

  ● 2004/11/9 3.23 beta 9

    ・メニューから「終了」を選んだときに System.exit ではなくウィンドウを閉じ
      る操作による通常の終了方法にした
    ・グラフィカルボタンで栞を読み込んだ場合に「オブジェクトは既に無効化されて
      います」のエラーがでる可能性があったのを修正

  ● 2004/10/24 3.23 beta 8

    ・メッセージ履歴が縦書きで everypage = true のとき、キーボードのカーソル
      キーの← →が逆だったのを修正

  ● 2004/10/10 3.23 beta 7

    (変更点はありません)

  ● 2004/9/25 3.23 beta 6

    (変更点はありません)

  ● 2004/9/16 3.23 beta 5

    ・Config.tjs でメッセージレイヤのタイプ (ltAlphaかltAddAlphaか)を指定で
      きるように (従来使っていたメッセージ枠画像などの表示がおかしい場合は、
      この設定 (layerTypeの設定) を変えるか、メッセージ枠画像を ltAddAlpha
      形式にしてください )
    ・背景レイヤに対して index を指定すると、それが前景レイヤに copy された
      ときにそのセーブデータをロードできなくなる可能性があったのを修正
    ・インライン画像やチェックボックスの記号などが正常に表示されなかったのを
      修正(Layer.holdAlphaのデフォルト値が偽になったため; beta4で混入)
    ・ガンマ補正を加算アルファ合成に対応

  ● 2004/8/30 3.23 beta 4

    ・メッセージレイヤを従来の ltAlpha ではなく ltAddAlpha で描画するように
      (ltAlphaよりもltAddAlphaの方がパフォーマンスが良い為)

  ● 2004/8/22 3.23 beta 3

    ・本体側の定数名称変更に伴い、KAG内の定数も変更
    ・image タグや pimage タグの mode 属性で"opaque" "alpha" "addalpha" を
      使用可能に
    ・TLG5/6のタグ情報に従うようになった (imageタグの属性省略時の動作が、画
      像に埋め込まれている情報に従うようになります。現段階では「画像フォー
      マットコンバータ」が、TLG5/6にimageタグのmode属性に対応する情報を書き
      出します)

  ● 2004/8/11 3.23 beta 2

    ・グラフィカルボタンとリンクを同時に表示した場合にTAB・カーソル移動順が
      おかしくなっていたのを修正

  ● 2004/7/4 3.23 beta 1

    (変更点はありません)

  ● 2004/6/23 3.22 Rev.2

    ・バージョン情報ダイアログボックスやYes/Noダイアログでパッドボタン3を押
      すとおかしな動作をしていたのを修正
    ・クリッカブルマップが選択可能状態になったらマウスカーソルを表示するよう
      に

  ● 2004/6/20 3.22 Release

    ・????su.kdt が空だったときにエラーになることがあったのを修正

  ● 2004/5/31 3.22 RC2

    (変更点はありません)

  ● 2004/5/23 3.22 RC1

    (変更点はありません)

  ● 2004/5/16 3.21 beta 9

    ・吉里吉里本体側の仕様変更(TJS2の後置!演算子関連)に伴い修正

  ● 2004/5/6 3.21 beta 8

    ・Config.tjsでサムネイル保存時のサイズと画質を指定できるように

  ● 2004/5/3 3.21 beta 7

    (変更点はありません)

  ● 2004/4/26 3.21 beta 6

    ・本体側の仕様変更に伴いIME制御を行うようにした
      (editタグによる単一行エディットでのみIMEが有効になるようになっています)

  ● 2004/4/12 3.21 beta 5

    ・アニメーション情報のレイヤ間でのコピー後に不正なメモリブロックを参照し
      ていたのを修正(beta4で混入)
    ・パッドでの操作に暫定対応

  ● 2004/4/12 3.21 beta 4

    ・「自動的に読み進む」で行末またはページ末クリック待ち時にキャンセルした
      ときにはその場で停止するように修正
    ・先頭行が空行のシナリオファイルを読み込んだときに不正なメモリブロックを
      参照していたのを修正
    ・waittrigタグでスキップ時にonskip属性が効かなかったのを修正
    ・positionタグにvisible属性(可視かどうか)追加
    ・stopmoveタグで裏画面(背景レイヤ以外)の自動移動が停止していなかったの
      を修正
    ・マウスで選択肢の上を通過した後にキーボードで選択肢を選択できない場合が
      あったのを修正
    ・グラフィカルボタンを押した後、選択肢ロックが働いているにもかかわらず
      onleave属性の式が実行されてしまっていたのを修正
    ・(本体はパッドに対応しましたがKAGはまだです)

  ● 2004/4/2 3.21 beta 3

    ・asd (アニメーション定義ファイル)内で iscript が使えなかったのを修正

  ● 2004/2/23 3.21 beta 2

    (変更点はありません)

  ● 2004/1/8 3.21 beta 1

    (変更点はありません)

  ● 2003/12/16 3.20 release

  ● 2003/12/6 3.19 beta 19

    ・image タグの mode 属性などに "screen" スクリーン乗算 を追加

  ● 2003/11/14 3.19 beta 18

    (変更点はありません)

  ● 2003/11/11 3.19 beta 17

    (変更点はありません)

  ● 2003/9/28 3.19 beta 16

    (変更点はありません)

  ● 2003/9/21 3.19 beta 15

    (変更点はありません)

  ● 2003/9/11 3.19 beta 14

    ・本体側のアーカイブ区切り記号の変更に伴い Initialize.tjs を修正

       *注意*

       アーカイブ名とアーカイブ内ファイル名を区切る記号が '#' から '>' に変
       わったため、新しい本体では古い KAG が動作しない可能性があります。
       特に古い Initialize.tjs をそのまま使おうとしてエラーが出た場合、
       Initialize.tjs 内で Storages.addAutoPath の次の (  ) カッコ 内に "#"
       を見つけたら、それを ">" に書き換える必要があります。


  ● 2003/9/10 3.19 beta 13

    ・krflash.dll や krmovie.dll が見つからなかった場合はエラー停止するように

  ● 2003/9/6 3.19 beta 12

    ・メッセージレイヤで設定したフォントが@editタグで作成した単一行エディタに
      反映されないことがあったのを修正

  ● 2003/8/19 3.19 beta 11

    ・Config.tjs の項目に saveMacros 追加 (マクロを栞に保存するか)
    ・アニメーション情報がレイヤ間で正常にコピー出来ていなかったのを修正

  ● 2003/8/4 3.19 beta 10

    ・image タグの mode 属性などに "lighten" 比較(明るい) を追加

  ● 2003/7/5 3.19 beta 9

    ・画像に clip (image属性などのclipleftなど) が指定されているとクリッカブ
      ルマップが正常に動作しなかったのを修正

  ● 2003/6/22 3.19 beta 8

    ・image タグの mode 属性などに "darken" 比較(暗) を追加

  ● 2003/6/7 3.19 beta 7

    ・シナリオ中のタブ文字を無視するように

  ● 2003/6/1 3.19 beta 6

    ・エラー処理の方法を変更 (エラー時の処理を Initialize.tjs にある
      System.exceptionHandler に登録している関数で一括して書けます )

  ● 2003/5/14 3.19 beta 5

    ・(本体側の機能追加に伴い) Config.tjs の saveDataMode に "z" (圧縮) を指
      定できるように
    ・Config.tjs のメッセージ履歴の設定に storeState (栞にメッセージ履歴を保
      存するか)、maxPages, maxLines (保持最大数) を追加

  ● 2003/5/4 3.19 beta 4

    ・xchgbgm タグに volume 属性追加 ( 次の曲の音量を指定 )
    ・pimage タグの mode 属性に add, sub, mul, dodge を指定可能に

  ● 2003/4/19 3.19 beta 3

    ・kag.process をTJS等から呼んだときに以降の実行のタイミングが不安定になる
      場合があったのを修正

  ● 2003/4/4 3.19 beta 2

    ・前景レイヤにクリッカブルマップを使った場合その上でマウスをクリックして
      も「メッセージを隠す」を解除できなかったのを修正

  ● 2003/3/17 3.19 beta 1

    ・未知のタグがあった場合はエラーにするように
    ・いまだアニメーションの情報がbacklayやtransタグで正常にコピーされていな
      かったのを修正

  ● 2003/3/7 3.18 release

    (変更点はありません)

  ● 2003/2/25 3.17 beta 10

    ・スキップ中のクリックによる停止をよりやりやすくした

  ● 2003/2/19 3.17 beta 9

    ・Config.~new の改行コードが一部おかしかったのを修正

  ● 2003/2/18 3.17 beta 8

    ・ptext タグ追加 (前景/背景レイヤに文字を描画)

  ● 2003/2/10 3.17 beta 7

    ・「雨」プラグイン添付
    ・「自動的に読み進む」で[l]タグに対するウェイトも指定できるように

  ● 2003/2/7 3.17 beta 6

    ・seopt タグに pan (パン) を追加
    ・image タグの mode 属性に指定可能な値として "sub"(減算合成)、
    "mul"(乗算合成)、"dodge"(覆い焼き) 追加

  ● 2003/2/3 3.17 beta 5

    (変更点はありません)

  ● 2003/1/28 3.17 beta 4

    ・button, link タグに clickse, clicksebuf 属性など追加 ( クリックしたとき
      などに効果音を再生 )
    ・グローバル関数 kansuuji, kansuuji_simple, number_format 追加 ( 数値の
      漢数字への変換、３桁ごとにカンマを入れる関数 )

  ● 2003/1/24 3.17 beta 3

    (変更点はありません)

  ● 2003/1/20 3.17 beta 2

    (変更点はありません)

  ● 2003/1/10 3.17 beta 1

    (変更点はありません)

  ● 2002/12/31 3.16 release

    ・kag.callExtraConductor や右クリックサブルーチンから 栞を読み込んだとき
      に「次の選択肢/未読まで進む」が使用不可になってしまう不都合を修正

  ● 2002/12/19 3.15 beta 6

    ・edit タグや checkbox タグで作成したオブジェクトの属性が backlay 等で
      正しくコピーされないことがあったのを修正

  ● 2002/12/8 3.15 beta 5

    (変更点はありません)

  ● 2002/12/3 3.15 beta 4

    ・kag.keyDownHook で、メッセージレイヤにフォーカスがある状態でいくつかの
      キーの情報を得られなかったのを修正

  ● 2002/11/29 3.15 beta 3

    ・image タグで mode=add が可能に (加算合成)

  ● 2002/11/25 3.15 beta 2

    ・前景レイヤに対して色ブレンドによる色補正が正しく動作しなかったのを修正
    ・erasemacro タグが動作しなかったのを修正

  ● 2002/11/13 3.15 beta 1

    ・iscript中でのエラー発生時の行情報の表示をわかりやすくした

  ● 2002/10/17 3.14 release

    ・実行可能ファイルと同じ場所にある Override2.tjs、AfterInit2.tjs も読み込
      むように ( beta 8 で導入した仕様の変更 )

  ● 2002/10/12 3.13 beta 9

    ・MessageLayer.setFocusToLink でリンクに移動したときにマウスカーソル位置
      による選択ロックが解除されなかったのを修正

  ● 2002/10/5 3.13 beta 8

    ・実行可能ファイルと同じ場所にある Override.tjs、AfterInit.tjs も読み込む
      ように

  ● 2002/10/3 3.13 beta 7

    ・(Conductor内で捕捉している)エラーでもファイルへのログ記録開始ができるよ
      うにした

  ● 2002/9/30 3.13 beta 6

    ・スナップショットのサムネイル画像付き栞の保存に失敗した場合、以降のス
      ナップショットがロックされたままになってしまっていたのを修正

  ● 2002/9/24 3.13 beta 5

    ・「待ち」状態の時にクリックで自動読みすすみやスキップの解除がやりにくかっ
      たのを改善

  ● 2002/9/20 3.13 beta 4

    (変更点はありません)

  ● 2002/9/17 3.13 beta 3

    ・TJS2 の "with" の予約語化に伴い、f.with や sf.with という変数名が使え
      なくなります。この変数名を使っている場合は他の変数名に変えてください。

      (その他、動作に影響を与えるような変更点はありません)

  ● 2002/9/14 3.13 beta 2

    ・KAG プラグインのサンプル ( systembutton.ks ) 追加
      (画面に「セーブ」「ロード」のボタンを表示するサンプル)

      (その他、動作に影響を与えるような変更点はありません)

  ● 2002/9/11 3.13 beta 1

    ・Config.tjs のメッセージ履歴の設定 vertical を verticalView に変更
    ・hact endhact タグ追加 ( メッセージ履歴のアクション )
        (使い方の例は「TJS をもっとつかうために」参照)

  ● 2002/8/31 3.12 release

    (変更点はありません)

  ● 2002/8/24 3.11 beta 7

    ・Config.tjs に defaultLinkOpacity 設定を追加
    ・栞を読み込むときに(extraConductorの)シナリオキャッシュをクリアするよう
      にした
    ・MessageLayer.setFocusToLink(n, true) でリンク番号 n にマウスカーソルを
      移動できるように

  ● 2002/8/20 3.11 beta 6

    ・XML版タグ情報ファイル (tags.xml) 添付
      ただし DTD ありません。構造はとりあえず中身みて知ってください(^^;
      タグ情報データベースとして活用してください。

  ● 2002/8/19 3.11 beta 5

    (変更点はありません)

  ● 2002/8/13 3.11 beta 4

    ・メッセージ履歴表示中に「前に戻る」「最初に戻る」を選択すると以降表示が
      おかしくなっていたのを修正

  ● 2002/8/3 3.11 beta 3

    ・フリーセーブモードで栞をたどるときに前回保存/読み込みしたファイル名を
      デフォルトで選択するようにした
    ・copybookmark タグが動作しなかったのを修正

  ● 2002/7/27 3.11 beta 2

    ・cursor タグにマウスカーソル定数を指定できなかったのを修正
    ・フリーセーブモードで栞の保存名が指定されていない場合は、前回の栞保存
      ファイル名を引き継ぐようにした ( 初期ファイル名はウィンドウタイトル )

  ● 2002/7/23 3.11 beta 1

    ・本体側の仕様変更により、BGM や効果音で loop=false で再生したときには
      ループ情報 ( .sli ファイル ) を無視するようになった
    ・スペアナプラグイン追加

  ● 2002/7/5 3.10 release

    (変更点はありません)

  ● 2002/7/2 3.09 beta 9

    (変更点はありません)

  ● 2002/6/28 3.09 beta 8

    ・右クリックサブルーチンから戻り先指定ありのreturnで戻ったときにエラーに
      なっていたのを修正
    ・pimage タグ追加 ( 画像の部分追加読み込み )

  ● 2002/6/21 3.09 beta 7

    ・リファレンスの wf タグ(効果音のフェード終了待ち)の記述抜けの修正
    ・about.ks 表示時にデフォルトのデータ保存場所に書き込んでいたのを修正

  ● 2002/6/18 3.09 beta 6

    ・メッセージ履歴で「前のページ」「次のページ」を操作した時の表示が変だっ
      たのを修正

  ● 2002/6/16 3.09 beta 5

    ・セーブデータの形式の変更 ( セーブデータ関連の新しい仕様については
      KAG3 ドキュメントの「セーブデータに関して」を参照してください )
    ・rclick_tjs.ks 更新

       *重要*

       セーブデータ関連の仕様が変わったので、以前のプロジェクトの KAG のシス
       テムを新しくするときは注意してください。


  ● 2002/6/10 3.09 beta 4

    ・エンティティ ( & つきの属性 ) で void が渡された場合は void として処理
      ( 値が省略された場合の処理を ) するようにした ( いままでは空文字列に
      変換されていた )

  ● 2002/6/7 3.09 beta 3

    ・Enterキーまたはスペースキー長押しでメッセージ早送りになるように
    ・clip で画像を読み込むときにエラーがでる場合があったのを修正
    ・メニューバーの「栞をたどる/挟む」の使用可/不可を変えないようにした

  ● 2002/6/3 3.09 beta 2

    ・「自動的に読み進む」のときのウェイトを５段階から選べるようにした
    ・キーボード操作中はマウスカーソルを隠すようにした

  ● 2002/5/29 3.09 beta 1

    ・メッセージ履歴の閲覧をページ単位で表示できるように ( Config.tjs の
      everypage )
    ・メッセージ履歴での禁則処理を行うように
    ・hr タグに repage 属性追加

  ● 2002/5/23 3.08 release

    ( 動作に影響を与えるような変更点はありません )

  ● 2002/5/18 3.07 beta 6

    ( 動作に影響を与えるような変更点はありません )

  ● 2002/5/11 3.07 beta 5

    ( 動作に影響を与えるような変更点はありません )

       *重要*
       吉里吉里本体側の文字表示関連の処理が変わったことにより、字詰めが変わ
       ることがあります。Config.tjs の defaultPitch の設定や、style/defstyle
       タグの pitch 属性で調節してください。

  ● 2002/5/9 3.07 beta 4

    ・Config.tjs に「追加の設定」を書けるように
    ・まれに栞をたどったときに(本来表示されないはずの)クリック待ち記号が表示
      されてしまうことがあったのを修正
    ・メッセージ履歴に出力するかの情報が栞に保存されていなかったのを修正

  ● 2002/5/3 3.07 beta 3

    ・マクロ処理を高速化 ( 従来の栞をの読み込みでエラーになる場合があります )
    ・button タグに recthit 属性追加 ( 当たり判定を矩形で行うかどうか )

  ● 2002/4/29 3.07 beta 2

    ・wait mode=until で実際に待った時間を kag.lastWaitTime に設定するように
    ・ラベル名の重複や省略を許すようにした

  ● 2002/4/26 3.07 beta 1

    ・KAG プラグインサンプルの rclick_tjs 修正
    ・アニメーションレイヤのコピー時 ( backlay 等 ) でエラーが出ることがあっ
      たのを修正

  ● 2002/4/21 3.06 release

    ・KAGWindow.onConductorUnknownTag 追加 ( 不明なタグを処理する )

  ● 2002/4/17 3.05 beta 7

    ・エンティティの結果を文字列に変換してから解釈するようにした

  ● 2002/4/14 3.05 beta 6

    ・waitclick タグ追加 ( クリックを待つ )

  ● 2002/4/10 3.05 beta 5

    ・マクロ中でジャンプしたときに内部のマクロ引数スタックをクリアしてなかっ
      たのを修正
    ・マクロにアルファベット大文字を使うとマクロを使えなかったのを修正
    ・スタッフロールプラグインを縦書きに対応させた
    ・KAG プラグインサンプルの rclick_tjs 増強
    ・move タグに accel 属性追加 ( 加速度的な動きを行うかどうか )
    ・ButtonLayer.showFocusImage 追加
    ・KAGPlugin.onSaveSystemVariables 追加
    ・栞に書き込み禁止属性をつけられるように ( ただし TJS で
      kag.setBookMarkProtectetState を呼ぶ必要あり )

  ● 2002/4/6 3.05 beta 4

    ・「自動的に読み進む」で自動改ページ時に停止してしまっていたのを修正
    ・同じレイヤがトランジション中にもう一度トランジションしようとしたらエ
      ラーにするようにした

  ● 2002/4/2 3.05 beta 3

    ・クリッピング方式のアニメーションの方式を記述できるように
      ( Animation.tjs 参照 )
    ・kag.leftClickHook, kag.rightClickHook, kag.keyDownHook 追加
      ( クリックやキー押下で指定の関数を呼ぶ )
    ・「自動的に読み進む」の機能追加 ( cancelautomode タグ追加 )

  ● 2002/3/31 3.05 beta 2

    ・「スタッフロール」プラグイン追加

  ● 2002/3/28 3.05 beta 1

    ・二重起動を防止するようにした
    ・nextskip タグが動作していなかったのを修正
    ・通過記録機能追加 ( record, goback タグ、 Config.tjs への項目追加など )

  ● 2002/3/24 3.04 release

    ・layopt タグの autohide 属性が動作していなかったのを修正

  ● 2002/3/20 3.03 beta 6

    ・アニメーション定義ファイル内で eval, iscript, endscript を使用可能に
    ・call 直後の if タグが無視されることがあったのを修正
    ・autoRecordPageShowing が false のときに、ラベルでスキップが停止してし
      まっていたのを修正

  ● 2002/3/13 3.03 beta 5

    ・image タグに pos 属性追加 ( 前景レイヤ位置の自動決定 )

  ● 2002/3/12 3.03 beta 4

    ・文字表示関連を少し高速化

  ● 2002/3/7 3.03 beta 3

    ・自動改ページ時にメッセージ履歴に文字が２回出力されていたのを修正
    ・TJS2 のバグに関し、関連する箇所を修正

  ● 2002/3/3 3.03 beta 2

    ・メッセージ隠蔽時にクリッカブルマップを選択できてしまっていたのを修正
    ・マウスエミュレーションが効かなくなることがあったのを修正

  ● 2002/2/26 3.03 beta 1

    ・ズームプラグイン更新 ( 前景レイヤのズームもできるように )

  ● 2002/2/11 3.02 release

    ・いくつかの処理の高速化

  ● 2002/2/8 3.01 beta 4

	(変更点はありませんが、便宜上 beta 4 とします)

  ● 2002/2/7 3.01 beta 3

    ・button link タグの countpage 属性が効いていなかったのを修正
    ・hch タグ追加 ( 縦中横 )
    ・アニメーション情報がレイヤ間でコピーされるときにタイミングの情報をよ
      り厳密にコピーするようにした

  ● 2002/2/6 3.01 beta 2

    ・waittrig タグに canskip 属性と onskip 属性追加
    ・背景画像のズームを行うズームプラグイン追加

  ● 2002/2/2 3.01 beta 1

    ・kag.callExtraConductor 追加 ( TJS の制御で KAG のサブルーチンを呼ぶ )
    ・右クリックサブルーチン呼び出し時に自動的に @locklink を行うようにした

  ● 2002/1/31 3.00 release

    ・edit タグと checkbox タグに bgcolor, color, opacity 属性追加
    ・edit タグに maxchars 属性追加
    ・graph タグの ALT 属性が機能しなかったのを修正

  ● 2002/1/17 β41

	(変更点はありませんが、便宜上β41とします)

  ● 2002/1/12 β40

    ・MIDI データ再生開始時に音源初期化メッセージなどを送れるように
    ・クリッカブルマップ無効状態が栞読み出し時に再構成できなかったのを修正

  ● 2002/1/7 β39

    ・ホイール操作と履歴表示関連の改良
    ・メッセージレイヤにフレーム画像を指定するときにサイズを自動的にフレーム
      画像に合わせるようにした

  ● 2002/1/3 β38

    ・裏画面のレイヤに対して move タグを適用できなかったのを修正
    ・delay タグで speed=user とすると既読でも未読の場合の速度と同じになって
      しまっていたを修正

  ● 2001/12/28 β37

    ・if/ignore タグでの条件に関わりなく iscript タグが実行されていたのを修正
    ・シナリオ中のラベルの検索の高速化
    ・変数中の配列/辞書配列が「セーブ可能なラベル」で正しくコピーされていな
      かったのを修正

  ● 2001/12/22 β36

    ・waittrig タグ追加 (TJSスクリプトからのトリガを待つ)
    ・「はい」「いいえ」を選択するダイアログボックスを ESC キーで閉じられる
      ように
    ・「一度読んだところは > ページ末まで一気に」メニュー追加
    ・マウスホイールの回転でメッセージ履歴を出すように
    ・バージョン情報ダイアログの書き方 Tips 追加
    ・KAG プラグインのサンプルを追加

  ● 2001/12/16 β35

    ・TJS式 Tips をドキュメントに追加
    ・Config.tjs を自動的に引き継ぐことができるように

  ● 2001/12/12 β34

    ・「ヘルプ - このソフトについて」「ヘルプ - 目次」メニューを追加
    ・栞を読み込むとメニューの「システム > 文字 > アンチエイリアス」の指定が
      無効になる場合があったのを修正

  ● 2001/12/08 β33

    ・前景レイヤのクリッカブルマップのアクションが定義されている場所で右ク
      リックが有効にならなかったのを修正
    ・openvideo タグ追加 ( ビデオ再生の準備 )
    ・Flash 再生への対応
    ・KAG 用プラグイン ( 雪と音量調整 ) を添付

  ● 2001/12/03 β32

    ・seopt と bgmopt タグに gvolume 属性追加 ( 大域ボリューム )

  ● 2001/11/29 β31

	・unlocklink タグ追加 ( リンクのロックの解除 )
    ・リンクが表示されているときに Shift + ↑ でメッセージ履歴がでなかったの
      を修正
    ・ボタン類のクリック連打時の応答性を改善

  ● 2001/11/27 β30

    ・右クリックに対応するメニューの表示名が栞に保存されていなかったのを修正
    ・既読記録関連のバグを修正

  ● 2001/11/24 β29

    ・メッセージレイヤに対してトランジションを実行できなかったのを修正
    ・右クリックサブルーチン中で選択肢の選択を行うと右クリックから戻った先で
      選択肢が選択できなくなっていたのを修正
    ・セーブ可能なラベルの「見出し」に変数を使用できるようにした
      ( *label|&f.title など )

  ● 2001/11/19 β28

    ・既読の変数名の最初に "trail_" がついていなかったので修正
    ・draggable=true のメッセージレイヤ周りのヒント表示管理関連のバグを修正

  ● 2001/11/15 β27

    ・メニューに「文字表示 > ページ末まで一気に」追加 ( Config.tjs に 
      chNonStopToPageBreakItem.visible 追加 )

  ● 2001/11/13 β26

    ・効果音再生の音量周りのバグを修正
    ・メッセージ履歴のボタンを操作するとホイール操作ができなくなったのを修正
    ・locklink タグ追加

  ● 2001/11/09 β25

    ・メッセージ履歴をマウスホイールに対応

  ● 2001/11/04 β24

    ・縦書き時の edit の表示位置を調整
    ・ドキュメント ( チュートリアル ) をいろいろ追加

  ● 2001/10/29 β23

    ・前景レイヤ、メッセージレイヤのレイヤ順の扱いを相対位置から絶対位置に
    ・レイヤタイプが裏・表間でコピーされていなかったのを修正

  ● 2001/10/27 β22

    ・defstyle タグに autoreturn 属性追加、Config.tjs に defaultAutoReturn
      追加 ( 自動改行/改ページを行うかどうか )
    ・Config.tjs に showFixedPitchOnlyInFontSelector を追加
      ( フォント選択画面で固定ピッチフォントのみを列挙するかどうか )
    ・起動時に画面外にウィンドウがはみ出さないようにした
    ・2 個目以降のパッチ用アーカイブが正常に認識されなかったのを修正
    ・img タグが動作していなかったのを修正
    ・タグリファレンスでトランジションの種類としてクロスフェード
      ( method=crossfade ) の記述を忘れていたので追加
    ・クリッカブルマップ関連の機能を追加 ( ドキュメントも追加 )
    ・mapimage, mapaction, mapdisable タグ追加 ( クリッカブルマップ関連 )
    ・アニメーションセグメント関連の機能を追加
    ・animstart, animstop, wa タグ追加
    ・前バージョンとのセーブデータの互換性が無くなったかもしれません

  ● 2001/10/18 β21

    ・メッセージ消去後などの直後の一文字の描画のタイミングに関する問題を修正
    ・いくつかのスクリプトを、必要になってから読み込むようにした

  ● 2001/10/16 β20

    ・エディット、チェックボックスにフォーカスがある状態でメッセージレイヤが
    消去されるとマウスカーソルが移動してしまっていたのを修正

  ● 2001/10/13 β19

    ・rclick タグに jump タグ追加 ( 右クリックで指定場所までジャンプ )
    ・右クリックサブルーチンが２回目以降正常に呼ばれない事があったのを修正
    ・右クリックサブルーチンから栞を読み込むのに失敗することがあったのを修正

  ● 2001/10/12 β18

    ・フォーム関連タグ追加 ( edit, checkbox, commit )
    ・効果音再生時のエラーを無視するようにした

  ● 2001/10/6 β17

    ・move タグで time 属性が極端に小さいとエラーになっていたのを修正
    ・pausebgm, resumebgm タグ追加 ( ただし BGM 形式 "Wave" のみに使用可能 )
    ・乱数の初期化が正常に行われていなかったのを修正

  ● 2001/10/3 β16

    ・disablestore タグの属性が無視されていたのを修正
    ・ライセンスを独自のものに変更

  ● 2001/9/29 β15

    ・アニメーションセルに色調補正がかからなかったのを修正
    ・image タグに flipud と fliplr 属性追加 ( 上下反転と左右反転 )

  ● 2001/9/27 β14

    ・trans time=0 の場合に強制的に time=1 として扱うようにした
    ・current タグ withback 属性の実装を忘れていたので実装
    ・font タグ color 属性に default を指定するとエラーが発生していたのを修正

  ● 2001/9/26 β13

    ・選択肢ロック (いったん選択した選択肢を再び選択しないようにするためのも
      の) のロック方法にバグがあったので修正

  ● 2001/9/22 β12

    ・vertical 属性の設定が栞に保存されていなかったのを修正
    ・deffont と defstyle タグ追加
    ・栞ファイルが空だった場合にエラーになるのを修正
    ・タグ名、属性の大文字と小文字を区別しないようにした
    ・font, deffont タグの face 属性で "user" ( ユーザの指定したフォント ) を
      指定できるようにした
    ・Config.tjs defaultFace を userFace に変更 (名前が変わっただけ)
    ・ドキュメントに「背景を表示しよう」追加

  ● 2001/9/19 β11

    ・エラー時の表示形式を変更
    ・「デバッグ」メニュー追加 ( Config.tjs 内 debugMenu.visible )

  ● 2001/9/18 β10

    ・画面切り替え時、あるいは copylay, backlay 時にエラー(EAccess Violation)
      が発生する場合があったのを修正

  ● 2001/9/17 β９

	(動作に影響を与える変更点はありませんが、便宜上β９とします)

  ● 2001/9/15 β８

    ・フェードアウト中に playbgm タグがあると再生されなかったので修正
    ・書きかけの KAG ドキュメントを同梱

  ● 2001/9/13 β７

    ・erasemacro タグの実装を忘れていたので実装
    ・タグリファレンスを追加

  ● 2001/9/11 β６

    ・いまだマクロ展開が正常に行えない場合があったのを修正
    ・レンダリング済みフォントに対応させるため mappfont タグ追加

  ● 2001/9/8 β５

    ・マクロ展開が正常に行えない場合があったのを修正
    ・クリック待ち記号が非表示の状態でも裏でアニメーションを続けていたのを修
      正

  ● 2001/9/7 β４

    ・CD-DA のドライブ認識が正常に再生できていなかったのを修正
    ・ラベルのページ名 ( '|' よりあと ) を省略可能に
      ( 省略すると前のページ名を引き継ぎます )
    ・kag.shutdown 追加 ( いままで System.exit() を使っていたところを
      kag.shutdown() に置き換えてください。 より安全にシステムを終了できます )

  ● 2001/9/5 β３

    ・title タグで指定したタイトルが栞に保存されなかったのを修正
    ・メッセージ履歴でアンチエイリアス描画を行うかどうかを「文字表示」メニュー
      の設定に従うようにした
    ・「次の選択肢/未読まで進む」「メッセージを消す」「メッセージ履歴を表示」
      をキーボードから操作可能に

  ● 2001/9/2 β２

    ・trans method=scroll が正しく動作しなかったのを修正
    ・右クリックサブルーチンが正しく動作しなかったのを修正
    ・前のトランジションを終了させずに新しいトランジションを開始すると
      エラーになっていたのを修正


■ ライセンス --------------------------------------------------------------

  　付属の license.txt をご覧ください。


■ 作者連絡先 --------------------------------------------------------------

  W.Dee <dee@kikyou.info>

  吉里吉里ダウンロードページ : http://kikyou.info/tvp/

  一般的なご質問、バグのご報告などは「吉里吉里ダウンロードページ」内の
  「掲示板」をご利用ください。

  　IRC チャンネルを開設しております : #kirikiriirc

----------------------------------------------------------------------------
